<!DOCTYPE html>
<html>
<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <title>Working with Meteor Data</title>
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="stylesheet" type="text/css" href="../assets/built/screen.css">

    <link rel="shortcut icon" href="../favicon.ico" type="image/x-icon">
    <link rel="canonical" href="http://tysoncadenhead.com/working-with-meteor-data/">
    <meta name="referrer" content="no-referrer-when-downgrade">
    <link rel="amphtml" href="http://tysoncadenhead.com/working-with-meteor-data/amp/">
    
    <meta property="og:site_name" content="Tyson Cadenhead">
    <meta property="og:type" content="article">
    <meta property="og:title" content="Working with Meteor Data">
    <meta property="og:description" content="I previously introduced the Meteor framework and showed how to create a simple application. Today we are going to look a little deeper and explore how data works in Meteor. If that isn&#x27;t enough to get you excited, let me give you a teaser - Meteor literally lets you save">
    <meta property="og:url" content="http://tysoncadenhead.com/working-with-meteor-data/">
    <meta property="og:image" content="../content/images/2017/09/5-5.png">
    <meta property="article:published_time" content="2013-10-10T08:01:00.000Z">
    <meta property="article:modified_time" content="2017-09-26T02:25:59.000Z">
    <meta property="article:publisher" content="https://www.facebook.com/tysoncadenhead">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Working with Meteor Data">
    <meta name="twitter:description" content="I previously introduced the Meteor framework and showed how to create a simple application. Today we are going to look a little deeper and explore how data works in Meteor. If that isn&#x27;t enough to get you excited, let me give you a teaser - Meteor literally lets you save">
    <meta name="twitter:url" content="http://tysoncadenhead.com/working-with-meteor-data/">
    <meta name="twitter:image" content="http://tysoncadenhead.com/content/images/2017/09/5-5.png">
    <meta name="twitter:label1" content="Written by">
    <meta name="twitter:data1" content="Tyson Cadenhead">
    <meta name="twitter:site" content="@tysoncadenhead">
    <meta property="og:image:width" content="1391">
    <meta property="og:image:height" content="800">
    
    <script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "Article",
    "publisher": {
        "@type": "Organization",
        "name": "Tyson Cadenhead",
        "logo": "http://tysoncadenhead.com/content/images/2017/09/1-2.png"
    },
    "author": {
        "@type": "Person",
        "name": "Tyson Cadenhead",
        "image": {
            "@type": "ImageObject",
            "url": "//www.gravatar.com/avatar/283773207d6e2c2b9f2a86f7088a7328?s=250&d=mm&r=x",
            "width": 250,
            "height": 250
        },
        "url": "http://tysoncadenhead.com/author/tysoncadenhead/",
        "sameAs": []
    },
    "headline": "Working with Meteor Data",
    "url": "http://tysoncadenhead.com/working-with-meteor-data/",
    "datePublished": "2013-10-10T08:01:00.000Z",
    "dateModified": "2017-09-26T02:25:59.000Z",
    "image": {
        "@type": "ImageObject",
        "url": "http://tysoncadenhead.com/content/images/2017/09/5-5.png",
        "width": 1391,
        "height": 800
    },
    "description": "I previously introduced the Meteor framework and showed how to create a simple application. Today we are going to look a little deeper and explore how data works in Meteor. If that isn&#x27;t enough to get you excited, let me give you a teaser - Meteor literally lets you save",
    "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "http://tysoncadenhead.com/"
    }
}
    </script>

    <script type="text/javascript" src="../public/ghost-sdk.js"></script>
<script type="text/javascript">
ghost.init({
	clientId: "ghost-frontend",
	clientSecret: "f70092546f32"
});
</script>
    <meta name="generator" content="Ghost 1.8">
    <link rel="alternate" type="application/rss+xml" title="Tyson Cadenhead" href="http://tysoncadenhead.com/rss/">

</head>
<body class="post-template">

    <div class="site-wrapper">

        

<header class="site-header outer">
    <div class="inner">
        <nav class="site-nav">
    <div class="site-nav-left">
                <a class="site-nav-logo" href="../"><img src="../content/images/2017/09/1-2.png" alt="Tyson Cadenhead"></a>
            <ul class="nav">
    <li class="nav-blog" role="presentation"><a href="../">Blog</a></li>
    <li class="nav-about-me" role="presentation"><a href="../about/">About Me</a></li>
</ul>
    </div>
    <div class="site-nav-right">
        <div class="social-links">
                <a class="social-link social-link-fb" href="https://www.facebook.com/tysoncadenhead" target="_blank"><svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 32 32"><path d="M19 6h5V0h-5c-3.86 0-7 3.14-7 7v3H8v6h4v16h6V16h5l1-6h-6V7c0-.542.458-1 1-1z"/></svg>
</a>
                <a class="social-link social-link-tw" href="https://twitter.com/tysoncadenhead" target="_blank"><svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 32 32"><path d="M30.063 7.313c-.813 1.125-1.75 2.125-2.875 2.938v.75c0 1.563-.188 3.125-.688 4.625a15.088 15.088 0 0 1-2.063 4.438c-.875 1.438-2 2.688-3.25 3.813a15.015 15.015 0 0 1-4.625 2.563c-1.813.688-3.75 1-5.75 1-3.25 0-6.188-.875-8.875-2.625.438.063.875.125 1.375.125 2.688 0 5.063-.875 7.188-2.5-1.25 0-2.375-.375-3.375-1.125s-1.688-1.688-2.063-2.875c.438.063.813.125 1.125.125.5 0 1-.063 1.5-.25-1.313-.25-2.438-.938-3.313-1.938a5.673 5.673 0 0 1-1.313-3.688v-.063c.813.438 1.688.688 2.625.688a5.228 5.228 0 0 1-1.875-2c-.5-.875-.688-1.813-.688-2.75 0-1.063.25-2.063.75-2.938 1.438 1.75 3.188 3.188 5.25 4.25s4.313 1.688 6.688 1.813a5.579 5.579 0 0 1 1.5-5.438c1.125-1.125 2.5-1.688 4.125-1.688s3.063.625 4.188 1.813a11.48 11.48 0 0 0 3.688-1.375c-.438 1.375-1.313 2.438-2.563 3.188 1.125-.125 2.188-.438 3.313-.875z"/></svg>
</a>
        </div>
            <a class="subscribe-button" href="#subscribe">Subscribe</a>
    </div>
</nav>
    </div>
</header>


<main id="site-main" class="site-main outer" role="main">
    <figure class="post-full-image" style="background-image: url(../content/images/2017/09/5-5.png)">
    </figure>
    <div class="inner">

        <article class="post-full post ">

            <header class="post-full-header">
                <section class="post-full-meta">
                    <time class="post-full-meta-date" datetime="2013-10-10">10 October 2013</time>
                </section>
                <h1 class="post-full-title">Working with Meteor Data</h1>
            </header>

            <section class="post-full-content">
                <div class="kg-card-markdown"><p>I previously introduced the <a href="../blog/getting-started-with-meteor/">Meteor framework</a> and showed how to create a simple application. Today we are going to look a little deeper and explore how data works in Meteor. If that isn't enough to get you excited, let me give you a teaser - Meteor literally lets you save data on the client-side without having to deal with the internals of server-side code. Have I got your attention yet?</p>
<!-- more -->
<p>Out of the box, Meteor uses MongoDB to store data, but it doesn't stop there. There is a localstorage database that the client-side works with that automatically syncs with the server if it can, which means your applications will work perfectly fine offline.</p>
<p>So what does it look like to interact with storage in Meteor? Let's jump right in, shall we?</p>
<h2 id="settingupacollection">Setting up a collection</h2>
<p>Meteor organizes its data into collections. So if you want to save a list of all of your friends, you would create a new collection that looks something like this:</p>
<pre><code class="language-javascript">friends = new Meteor.Collection('friends');
</code></pre>
<p>Now, before you start yelling at me for not scoping the variable, Meteor will automatically detect global variables during the compiling process and scope them for us.</p>
<p>We should put the above collection code somewhere where the client and the server can both access it, which means avoiding the <code>client</code> and <code>server</code> directories. I would put it in a file called <code>/collections/friends.js</code>.</p>
<h2 id="insertingdata">Inserting data</h2>
<p>Now that we have our friends collection set up, we can add data to it. To give it a shot, just open your browser console and insert the data.</p>
<pre><code class="language-javascript">friends.insert({
   firstName: 'Bugs',
   lastName: 'Bunny'
});
</code></pre>
<p>Note that the <code>friends</code> variable that we are tapping into is the collection that we previously created. We should get back the id of the friend that was inserted. The id is randomly generated for us. The result should look something like this:</p>
<p><img src="../images/blog/meteor-2-1.png/" alt="Inserting Meteor data"></p>
<h2 id="findingasinglerecord">Finding a single record</h2>
<p>Getting a record is simple. You just use the findOne method on your collection. The first argument is your record id. As you may recall, we got the id back when we inserted our first friend, so we can use that.</p>
<pre><code class="language-javascript">friends.findOne('wyzkT6BPmFbnjyfDr');
</code></pre>
<p>The results should look something like this:</p>
<p><img src="../images/blog/meteor-2-2.png/" alt="Meteor findOne"></p>
<h2 id="findingmultiplerecords">Finding multiple records</h2>
<p>Let's go ahead and add a couple more records to our collection:</p>
<pre><code class="language-javascript">friends.insert({ firstName: 'Elmer', lastName: 'Fudd' });
friends.insert({ firstName: 'Daffy', lastName: 'Duck' });
</code></pre>
<p>Now, we can use find to get all of the records that match our criteria. The find method returns a cursor which we can use to either <code>fetch</code> the data or do a <code>forEach</code> to iterate over the data once it is returned. Let's find and fetch every record where the first name is Elmer:</p>
<pre><code class="language-javascript">friends.find({ firstName: 'Elmer' }).fetch();
</code></pre>
<p>That should return an array with the one record that matches or criteria:</p>
<p><img src="../images/blog/meteor-2-3.png/" alt="Meteor find and fetch"></p>
<p>If we updated Daffy Duck to be named Elmer Duck and fetched our data again, we would get back both records:</p>
<pre><code class="language-javascript">friends.update('Ze9vGfh3R3iTPjef7', { firstName: 'Elmer', lastName: 'Duck' });
friends.find({ firstName: 'Elmer' }).fetch();
</code></pre>
<p>The query above would result in:</p>
<p><img src="../images/blog/meteor-2-4.png/" alt="find and fetch with meteor"></p>
<p>Also, if you don't pass any arguments into the find method, you will get back all of your friends.</p>
<h2 id="permissions">Permissions</h2>
<p>If you've been developing applications for a while, you may feel a little cautious about letting the client save data. Not to worry, the real work is actually happening on the server, Meteor handles everything for you automagically so you don't actually have to write most of the server-side pieces.</p>
<p>Since the server is doing the work, you can allow or deny any database transactions you want on the server, which bubbles up to the client.</p>
<p>Let's return to the <code>collections/friends.js</code> file that we made earlier. We can add an allow method to the friends collection and specify that we will only allow a record to be inserted if the first name of the friend is “Elmer“.</p>
<pre><code class="language-javascript">friends.allow({
    insert: function (userId, record) {
       if (record.firstName === 'Elmer') {
           return true;
       }
    }
});
</code></pre>
<p>Now, when we try to insert Tweety Bird, we won't be allowed to because his first name is definitely not Elmer.</p>
<p><img src="../images/blog/meteor-2-5.png/" alt="Meteor allow"></p>
<p>If you want to listen for failures to insert data into the database, the second argument of insert will be a callback function with an object detailing the error if there is one.</p>
<pre><code class="language-javascript">friends.insert({
    firstName: 'Tweety',
    lastName: 'Bird'
}, function (err) {
    console.log(err);
});
</code></pre>
<p>The object that you pass into <code>allow</code> can also contain filters for “update“ and “remove“ in addition to insert.</p>
<p>Meteor also adds a <code>deny</code> method to the collection that works exactly the opposite of allow. If the method in deny returns true, the client is not allowed to write data to the server.</p>
<p>So, that covers the basics of dealing with Meteor data. As you can see, Meteor makes working with data fun again. Cool, huh?</p>
</div>
            </section>

            <section class="subscribe-form">
                <h3 class="subscribe-form-title">Subscribe to Tyson Cadenhead</h3>
                <p>Get the latest posts delivered right to your inbox</p>
                <form method="post" action="/subscribe/" class="">
    <input class="confirm" type="hidden" name="confirm"><input class="location" type="hidden" name="location"><input class="referrer" type="hidden" name="referrer">

    <div class="form-group">
        <input class="subscribe-email" type="email" name="email" placeholder="youremail@example.com">
    </div>
    <button class="" type="submit"><span>Subscribe</span></button>
    <script type="text/javascript">(function(g,h,o,s,t){h[o]('.location')[s]=h[o]('.location')[s] || g.location.href;h[o]('.referrer')[s]=h[o]('.referrer')[s] || h.referrer;})(window,document,'querySelector','value');</script>
</form>


            </section>

            <footer class="post-full-footer">

                <section class="author-card">
                        <img class="author-profile-image" src="//www.gravatar.com/avatar/283773207d6e2c2b9f2a86f7088a7328?s=250&d=mm&r=x" alt="Tyson Cadenhead">
                    <section class="author-card-content">
                        <h4 class="author-card-name"><a href="../author/tysoncadenhead/">Tyson Cadenhead</a></h4>
                            <p>Read <a href="../author/tysoncadenhead/">more posts</a> by this author.</p>
                    </section>
                </section>
                <div class="post-full-footer-right">
                    <a class="author-card-button" href="../author/tysoncadenhead/">Read More</a>
                </div>

            </footer>


        </article>

    </div>
</main>

<aside class="read-next outer">
    <div class="inner">
        <div class="read-next-feed">

                <article class="post-card post">
        <a class="post-card-image-link" href="../getting-started-with-socket-io/">
            <div class="post-card-image" style="background-image: url(../content/images/2017/09/4-4.png)"></div>
        </a>
    <div class="post-card-content">
        <a class="post-card-content-link" href="../getting-started-with-socket-io/">
            <header class="post-card-header">
                <h2 class="post-card-title">Getting Started with Socket.io</h2>
            </header>
            <section class="post-card-excerpt">
                <p>In the old days, if you wanted to get up-to-date data from the sever, you would need to set an interval on the client-side and continuously make Ajax calls to see if new</p>
            </section>
        </a>
        <footer class="post-card-meta">
                <img class="author-profile-image" src="//www.gravatar.com/avatar/283773207d6e2c2b9f2a86f7088a7328?s=250&d=mm&r=x" alt="Tyson Cadenhead">
            <span class="post-card-author"><a href="../author/tysoncadenhead/">Tyson Cadenhead</a></span>
        </footer>
    </div>
</article>

                <article class="post-card post">
        <a class="post-card-image-link" href="../getting-started-with-socket-io-2/">
            <div class="post-card-image" style="background-image: url(../content/images/2017/09/4-5.png)"></div>
        </a>
    <div class="post-card-content">
        <a class="post-card-content-link" href="../getting-started-with-socket-io-2/">
            <header class="post-card-header">
                <h2 class="post-card-title">Getting Started with Socket.IO</h2>
            </header>
            <section class="post-card-excerpt">
                <p></p>
            </section>
        </a>
        <footer class="post-card-meta">
                <img class="author-profile-image" src="//www.gravatar.com/avatar/283773207d6e2c2b9f2a86f7088a7328?s=250&d=mm&r=x" alt="Tyson Cadenhead">
            <span class="post-card-author"><a href="../author/tysoncadenhead/">Tyson Cadenhead</a></span>
        </footer>
    </div>
</article>

        </div>
    </div>
</aside>

<div class="floating-header">
    <div class="floating-header-logo">
        <a href="../">
            <span>Tyson Cadenhead</span>
        </a>
    </div>
    <span class="floating-header-divider">&mdash;</span>
    <div class="floating-header-title">Working with Meteor Data</div>
    <div class="floating-header-share">
        <div class="floating-header-share-label">Share this <svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24">
    <path d="M7.5 15.5V4a1.5 1.5 0 1 1 3 0v4.5h2a1 1 0 0 1 1 1h2a1 1 0 0 1 1 1H18a1.5 1.5 0 0 1 1.5 1.5v3.099c0 .929-.13 1.854-.385 2.748L17.5 23.5h-9c-1.5-2-5.417-8.673-5.417-8.673a1.2 1.2 0 0 1 1.76-1.605L7.5 15.5zm6-6v2m-3-3.5v3.5m6-1v2"/>
</svg>
</div>
        <a class="floating-header-share-tw" href="https://twitter.com/share?text=Working%20with%20Meteor%20Data&url=http://tysoncadenhead.com/working-with-meteor-data/" onclick="window.open(this.href, 'share-twitter', 'width=550,height=235');return false;">
            <svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 32 32"><path d="M30.063 7.313c-.813 1.125-1.75 2.125-2.875 2.938v.75c0 1.563-.188 3.125-.688 4.625a15.088 15.088 0 0 1-2.063 4.438c-.875 1.438-2 2.688-3.25 3.813a15.015 15.015 0 0 1-4.625 2.563c-1.813.688-3.75 1-5.75 1-3.25 0-6.188-.875-8.875-2.625.438.063.875.125 1.375.125 2.688 0 5.063-.875 7.188-2.5-1.25 0-2.375-.375-3.375-1.125s-1.688-1.688-2.063-2.875c.438.063.813.125 1.125.125.5 0 1-.063 1.5-.25-1.313-.25-2.438-.938-3.313-1.938a5.673 5.673 0 0 1-1.313-3.688v-.063c.813.438 1.688.688 2.625.688a5.228 5.228 0 0 1-1.875-2c-.5-.875-.688-1.813-.688-2.75 0-1.063.25-2.063.75-2.938 1.438 1.75 3.188 3.188 5.25 4.25s4.313 1.688 6.688 1.813a5.579 5.579 0 0 1 1.5-5.438c1.125-1.125 2.5-1.688 4.125-1.688s3.063.625 4.188 1.813a11.48 11.48 0 0 0 3.688-1.375c-.438 1.375-1.313 2.438-2.563 3.188 1.125-.125 2.188-.438 3.313-.875z"/></svg>
        </a>
        <a class="floating-header-share-fb" href="https://www.facebook.com/sharer/sharer.php?u=http://tysoncadenhead.com/working-with-meteor-data/" onclick="window.open(this.href, 'share-facebook','width=580,height=296');return false;">
            <svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 32 32"><path d="M19 6h5V0h-5c-3.86 0-7 3.14-7 7v3H8v6h4v16h6V16h5l1-6h-6V7c0-.542.458-1 1-1z"/></svg>
        </a>
    </div>
    <progress class="progress" value="0">
        <div class="progress-container">
            <span class="progress-bar"></span>
        </div>
    </progress>
</div>




        <footer class="site-footer outer">
            <div class="site-footer-content inner">
                <section class="copyright"><a href="../">Tyson Cadenhead</a> &copy; 2017</section>
                <nav class="site-footer-nav">
                    <a href="../">Latest Posts</a>
                    <a href="https://www.facebook.com/tysoncadenhead" target="_blank">Facebook</a>
                    <a href="https://twitter.com/tysoncadenhead" target="_blank">Twitter</a>
                    <a href="https://ghost.org" target="_blank">Ghost</a>
                </nav>
            </div>
        </footer>

    </div>

    <div id="subscribe" class="subscribe-overlay">
        <a class="subscribe-overlay-close" href="#"></a>
        <div class="subscribe-overlay-content">
                <img class="subscribe-overlay-logo" src="../content/images/2017/09/1-2.png" alt="Tyson Cadenhead">
            <h1 class="subscribe-overlay-title">Subscribe to Tyson Cadenhead</h1>
            <p class="subscribe-overlay-description">Stay up to date! Get all the latest &amp; greatest posts delivered straight to your inbox</p>
            <form method="post" action="/subscribe/" class="">
    <input class="confirm" type="hidden" name="confirm"><input class="location" type="hidden" name="location"><input class="referrer" type="hidden" name="referrer">

    <div class="form-group">
        <input class="subscribe-email" type="email" name="email" placeholder="youremail@example.com">
    </div>
    <button class="" type="submit"><span>Subscribe</span></button>
    <script type="text/javascript">(function(g,h,o,s,t){h[o]('.location')[s]=h[o]('.location')[s] || g.location.href;h[o]('.referrer')[s]=h[o]('.referrer')[s] || h.referrer;})(window,document,'querySelector','value');</script>
</form>


        </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.2.1.min.js" crossorigin="anonymous">
    </script>
    <script type="text/javascript" src="../assets/js/jquery.fitvids.js"></script>


    <script>

// NOTE: Scroll performance is poor in Safari
// - this appears to be due to the events firing much more slowly in Safari.
//   Dropping the scroll event and using only a raf loop results in smoother
//   scrolling but continuous processing even when not scrolling
$(document).ready(function () {
    // Start fitVids
    var $postContent = $(".post-full-content");
    $postContent.fitVids();
    // End fitVids

    var progressBar = document.querySelector('progress');
    var header = document.querySelector('.floating-header');
    var title = document.querySelector('.post-full-title');

    var lastScrollY = window.scrollY;
    var lastWindowHeight = window.innerHeight;
    var lastDocumentHeight = $(document).height();
    var ticking = false;

    function onScroll() {
        lastScrollY = window.scrollY;
        requestTick();
    }

    function onResize() {
        lastWindowHeight = window.innerHeight;
        lastDocumentHeight = $(document).height();
        requestTick();
    }

    function requestTick() {
        if (!ticking) {
            requestAnimationFrame(update);
        }
        ticking = true;
    }

    function update() {
        var trigger = title.getBoundingClientRect().top + window.scrollY;
        var triggerOffset = title.offsetHeight + 35;
        var progressMax = lastDocumentHeight - lastWindowHeight;

        // show/hide floating header
        if (lastScrollY >= trigger + triggerOffset) {
            header.classList.add('floating-active');
        } else {
            header.classList.remove('floating-active');
        }

        progressBar.setAttribute('max', progressMax);
        progressBar.setAttribute('value', lastScrollY);

        ticking = false;
    }

    window.addEventListener('scroll', onScroll, {passive: true});
    window.addEventListener('resize', onResize, false);

    update();
});
</script>


    <script type="text/javascript">

    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-19696495-1']);
    _gaq.push(['_trackPageview']);

    (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://' : 'http://') + 'stats.g.doubleclick.net/dc.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();

</script>

<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css">
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>

</body>
</html>

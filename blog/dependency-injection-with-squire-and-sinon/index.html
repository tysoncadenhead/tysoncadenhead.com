<!DOCTYPE html>
<html>
<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <title>Dependency Injection With Squire and Sinon</title>
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="stylesheet" type="text/css" href="../assets/built/screen.css">

    <link rel="shortcut icon" href="../favicon.ico" type="image/x-icon">
    <link rel="canonical" href="http://tysoncadenhead.com/dependency-injection-with-squire-and-sinon/">
    <meta name="referrer" content="no-referrer-when-downgrade">
    <link rel="amphtml" href="http://tysoncadenhead.com/dependency-injection-with-squire-and-sinon/amp/">
    
    <meta property="og:site_name" content="Tyson Cadenhead">
    <meta property="og:type" content="article">
    <meta property="og:title" content="Dependency Injection With Squire and Sinon">
    <meta property="og:description" content="Unit testing in JavaScript can be difficult sometimes. Typically, you only want to test the behavior of a single module, but if you are using an AMD loader like RequireJS, you may be pulling in several other libraries and modules just to test a single module. The point of the">
    <meta property="og:url" content="http://tysoncadenhead.com/dependency-injection-with-squire-and-sinon/">
    <meta property="og:image" content="../content/images/2017/09/6-3.png">
    <meta property="article:published_time" content="2014-02-07T09:01:00.000Z">
    <meta property="article:modified_time" content="2017-09-26T02:06:20.000Z">
    <meta property="article:publisher" content="https://www.facebook.com/tysoncadenhead">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Dependency Injection With Squire and Sinon">
    <meta name="twitter:description" content="Unit testing in JavaScript can be difficult sometimes. Typically, you only want to test the behavior of a single module, but if you are using an AMD loader like RequireJS, you may be pulling in several other libraries and modules just to test a single module. The point of the">
    <meta name="twitter:url" content="http://tysoncadenhead.com/dependency-injection-with-squire-and-sinon/">
    <meta name="twitter:image" content="http://tysoncadenhead.com/content/images/2017/09/6-3.png">
    <meta name="twitter:label1" content="Written by">
    <meta name="twitter:data1" content="Tyson Cadenhead">
    <meta name="twitter:site" content="@tysoncadenhead">
    <meta property="og:image:width" content="1391">
    <meta property="og:image:height" content="800">
    
    <script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "Article",
    "publisher": {
        "@type": "Organization",
        "name": "Tyson Cadenhead",
        "logo": "http://tysoncadenhead.com/content/images/2017/09/1-2.png"
    },
    "author": {
        "@type": "Person",
        "name": "Tyson Cadenhead",
        "image": {
            "@type": "ImageObject",
            "url": "//www.gravatar.com/avatar/283773207d6e2c2b9f2a86f7088a7328?s=250&d=mm&r=x",
            "width": 250,
            "height": 250
        },
        "url": "http://tysoncadenhead.com/author/tysoncadenhead/",
        "sameAs": []
    },
    "headline": "Dependency Injection With Squire and Sinon",
    "url": "http://tysoncadenhead.com/dependency-injection-with-squire-and-sinon/",
    "datePublished": "2014-02-07T09:01:00.000Z",
    "dateModified": "2017-09-26T02:06:20.000Z",
    "image": {
        "@type": "ImageObject",
        "url": "http://tysoncadenhead.com/content/images/2017/09/6-3.png",
        "width": 1391,
        "height": 800
    },
    "description": "Unit testing in JavaScript can be difficult sometimes. Typically, you only want to test the behavior of a single module, but if you are using an AMD loader like RequireJS, you may be pulling in several other libraries and modules just to test a single module. The point of the",
    "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "http://tysoncadenhead.com/"
    }
}
    </script>

    <script type="text/javascript" src="../public/ghost-sdk.js"></script>
<script type="text/javascript">
ghost.init({
	clientId: "ghost-frontend",
	clientSecret: "f70092546f32"
});
</script>
    <meta name="generator" content="Ghost 1.8">
    <link rel="alternate" type="application/rss+xml" title="Tyson Cadenhead" href="http://tysoncadenhead.com/rss/">

</head>
<body class="post-template">

    <div class="site-wrapper">

        

<header class="site-header outer">
    <div class="inner">
        <nav class="site-nav">
    <div class="site-nav-left">
                <a class="site-nav-logo" href="../"><img src="../content/images/2017/09/1-2.png" alt="Tyson Cadenhead"></a>
            <ul class="nav">
    <li class="nav-blog" role="presentation"><a href="../">Blog</a></li>
    <li class="nav-about-me" role="presentation"><a href="../about/">About Me</a></li>
</ul>
    </div>
    <div class="site-nav-right">
        <div class="social-links">
                <a class="social-link social-link-fb" href="https://www.facebook.com/tysoncadenhead" target="_blank"><svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 32 32"><path d="M19 6h5V0h-5c-3.86 0-7 3.14-7 7v3H8v6h4v16h6V16h5l1-6h-6V7c0-.542.458-1 1-1z"/></svg>
</a>
                <a class="social-link social-link-tw" href="https://twitter.com/tysoncadenhead" target="_blank"><svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 32 32"><path d="M30.063 7.313c-.813 1.125-1.75 2.125-2.875 2.938v.75c0 1.563-.188 3.125-.688 4.625a15.088 15.088 0 0 1-2.063 4.438c-.875 1.438-2 2.688-3.25 3.813a15.015 15.015 0 0 1-4.625 2.563c-1.813.688-3.75 1-5.75 1-3.25 0-6.188-.875-8.875-2.625.438.063.875.125 1.375.125 2.688 0 5.063-.875 7.188-2.5-1.25 0-2.375-.375-3.375-1.125s-1.688-1.688-2.063-2.875c.438.063.813.125 1.125.125.5 0 1-.063 1.5-.25-1.313-.25-2.438-.938-3.313-1.938a5.673 5.673 0 0 1-1.313-3.688v-.063c.813.438 1.688.688 2.625.688a5.228 5.228 0 0 1-1.875-2c-.5-.875-.688-1.813-.688-2.75 0-1.063.25-2.063.75-2.938 1.438 1.75 3.188 3.188 5.25 4.25s4.313 1.688 6.688 1.813a5.579 5.579 0 0 1 1.5-5.438c1.125-1.125 2.5-1.688 4.125-1.688s3.063.625 4.188 1.813a11.48 11.48 0 0 0 3.688-1.375c-.438 1.375-1.313 2.438-2.563 3.188 1.125-.125 2.188-.438 3.313-.875z"/></svg>
</a>
        </div>
            <a class="subscribe-button" href="#subscribe">Subscribe</a>
    </div>
</nav>
    </div>
</header>


<main id="site-main" class="site-main outer" role="main">
    <figure class="post-full-image" style="background-image: url(../content/images/2017/09/6-3.png)">
    </figure>
    <div class="inner">

        <article class="post-full post ">

            <header class="post-full-header">
                <section class="post-full-meta">
                    <time class="post-full-meta-date" datetime="2014-02-07">7 February 2014</time>
                </section>
                <h1 class="post-full-title">Dependency Injection With Squire and Sinon</h1>
            </header>

            <section class="post-full-content">
                <div class="kg-card-markdown"><p>Unit testing in JavaScript can be difficult sometimes. Typically, you only want to test the behavior of a single module, but if you are using an AMD loader like RequireJS, you may be pulling in several other libraries and modules just to test a single module. The point of the unit test is to test an individual unit, not to test how it works with other dependencies.</p>
<p>If only there was a way to trick the test runner into thinking that the other modules were loaded by providing simplified stubs of the methods they actually performed! Good news, that is totally possible using <a href="https://github.com/iammerrick/Squire.js/">Squire</a>. Don't run away when you see the creepy looking mascot on the GitHub page, Squire is totally worth your time.</p>
<!-- more -->
<p>If you have used Angular, you are familiar with how dependency injection can work in JavaScript. Squire has extended this ability to work with any AMD module. The basic idea is that the module says that it needs “x dependency“, but Squire steps in and says “well, actually I'm going to give you y dependency instead, but you can still go on believing that it is x dependency. Silly you.“</p>
<p>Let's say that you have a module that looks like this:</p>
<pre><code class="language-js">// Person Module

define([
    'underscore',
    'friends'
], function (_, Friends) {

    var Person = function (data) {
        this.init(data);
    };

    _.extend(Person.prototype, {

        addFriend: function (data) {
            this.friends.add(data);
        },

        getId: function () {
            return this._id;
        },

        init: function (data) {
            this.friends = new Friends(data.id);
            this.addFriend({ id: 223 });
        }

    });

    return Person;

});
</code></pre>
<p>Obviously, it would have a friends dependency. That might look something like this:</p>
<pre><code class="language-js">// Friends Module

define([
    'underscore'
], function () {

    var Friends = function (id) {
        this.init(id);
    };

    _.extend(Friends.prototype, {

        add: function (friend) {
            this._friends.push(friend);
        },

        init: function (id) {
            this._friends = [];
            this._id = id;
        }

    });
    
});
</code></pre>
<p>Now, lets say we want to test the Person module, but we want to test Friends separately. First lets look at how that might be done without dependency injection:</p>
<pre><code class="language-js">define([
    'person'
], function (Person) {

    describe('the person module', function () {

        beforeEach(function () {
            this.person = new Person({
                id: 213
            });
        });

        describe('when adding a new friend', function () {
            it ('should add the friend to the the person', function () {
                assert.equal(this.person.getId(), 213);
            });
        });

    });

});
</code></pre>
<p>Not too terrible, but we are just requiring one module from the person and there aren't any weird side effects like there might be in a real-world example.</p>
<p>To stop actually using the friends module, we can do this:</p>
<pre><code class="language-js">define([
    'squire',
    'sinon'
], function (Squire, sinon) {

    var injector = new Squire();

    injector.mock({
        'friends': {
            add: sinon.stub()
        }
    });

    injector.require([
        'person'
    ], function (Person) {

        describe('the person module', function () {

            beforeEach(function () {
                this.person = new Person({
                    id: 213
                });
            });

            describe('when adding a new friend', function () {
                it ('should add the friend to the the person', function () {
                    this.person.addFriend(new Person({
                        id: 222
                    }));
                    assert.equal(this.person.find().length, 1);
                });
            });

        });

    });

});
</code></pre>
<p>Sure, it is a little more code, but here is what we have gained:</p>
<ul>
<li>We are no longer loading the friends dependency, so the test will run faster</li>
<li>We are testing the person module in isolation</li>
</ul>
<p>Not bad, huh?</p>
<p>Let's walk through how we did that.</p>
<p>First of all, we created a new injector by instantiating Squire.</p>
<p>Next, we gave Squire an object of dependencies that we wanted it to replace by using <code>injector.mock</code>. You might also noticed that we used a library called <a href="http://sinonjs.org/">Sinon</a> to create an empty function that could take the place of friends.add(). If you haven't used Sinon, you are missing out, it allows you to fake methods and return anything you want from them, which makes it a perfect companion for Squire.</p>
<p>Last, we required our module using <code>inject.require()</code>. While the API does look exactly like RequireJS, it is passing the call through Squire for dependency injection instead of requiring the dependencies.</p>
<p>Pretty cool, huh?</p>
</div>
            </section>

            <section class="subscribe-form">
                <h3 class="subscribe-form-title">Subscribe to Tyson Cadenhead</h3>
                <p>Get the latest posts delivered right to your inbox</p>
                <form method="post" action="/subscribe/" class="">
    <input class="confirm" type="hidden" name="confirm"><input class="location" type="hidden" name="location"><input class="referrer" type="hidden" name="referrer">

    <div class="form-group">
        <input class="subscribe-email" type="email" name="email" placeholder="youremail@example.com">
    </div>
    <button class="" type="submit"><span>Subscribe</span></button>
    <script type="text/javascript">(function(g,h,o,s,t){h[o]('.location')[s]=h[o]('.location')[s] || g.location.href;h[o]('.referrer')[s]=h[o]('.referrer')[s] || h.referrer;})(window,document,'querySelector','value');</script>
</form>


            </section>

            <footer class="post-full-footer">

                <section class="author-card">
                        <img class="author-profile-image" src="//www.gravatar.com/avatar/283773207d6e2c2b9f2a86f7088a7328?s=250&d=mm&r=x" alt="Tyson Cadenhead">
                    <section class="author-card-content">
                        <h4 class="author-card-name"><a href="../author/tysoncadenhead/">Tyson Cadenhead</a></h4>
                            <p>Read <a href="../author/tysoncadenhead/">more posts</a> by this author.</p>
                    </section>
                </section>
                <div class="post-full-footer-right">
                    <a class="author-card-button" href="../author/tysoncadenhead/">Read More</a>
                </div>

            </footer>


        </article>

    </div>
</main>

<aside class="read-next outer">
    <div class="inner">
        <div class="read-next-feed">

                <article class="post-card post">
        <a class="post-card-image-link" href="../there-is-more-than-one-way-to-loop-a-cat/">
            <div class="post-card-image" style="background-image: url(../content/images/2017/09/5-2.png)"></div>
        </a>
    <div class="post-card-content">
        <a class="post-card-content-link" href="../there-is-more-than-one-way-to-loop-a-cat/">
            <header class="post-card-header">
                <h2 class="post-card-title">There Is More Than One Way To Loop Over A Cat</h2>
            </header>
            <section class="post-card-excerpt">
                <p>When I first started writing JavaScript, most of the libraries that are around today weren't available, which meant that there were basically a few low-level ways to loop over an array of content.</p>
            </section>
        </a>
        <footer class="post-card-meta">
                <img class="author-profile-image" src="//www.gravatar.com/avatar/283773207d6e2c2b9f2a86f7088a7328?s=250&d=mm&r=x" alt="Tyson Cadenhead">
            <span class="post-card-author"><a href="../author/tysoncadenhead/">Tyson Cadenhead</a></span>
        </footer>
    </div>
</article>

                <article class="post-card post">
        <a class="post-card-image-link" href="../dom-manipulation-is-so-early-2000s/">
            <div class="post-card-image" style="background-image: url(../content/images/2017/09/7-2.png)"></div>
        </a>
    <div class="post-card-content">
        <a class="post-card-content-link" href="../dom-manipulation-is-so-early-2000s/">
            <header class="post-card-header">
                <h2 class="post-card-title">DOM Manipulation Is So Early 2000s</h2>
            </header>
            <section class="post-card-excerpt">
                <p>I remember when I first started playing with JavaScript in high-school. The first thing I loved about it was that I could change things without the browser even refreshing. It was like I</p>
            </section>
        </a>
        <footer class="post-card-meta">
                <img class="author-profile-image" src="//www.gravatar.com/avatar/283773207d6e2c2b9f2a86f7088a7328?s=250&d=mm&r=x" alt="Tyson Cadenhead">
            <span class="post-card-author"><a href="../author/tysoncadenhead/">Tyson Cadenhead</a></span>
        </footer>
    </div>
</article>

        </div>
    </div>
</aside>

<div class="floating-header">
    <div class="floating-header-logo">
        <a href="../">
            <span>Tyson Cadenhead</span>
        </a>
    </div>
    <span class="floating-header-divider">&mdash;</span>
    <div class="floating-header-title">Dependency Injection With Squire and Sinon</div>
    <div class="floating-header-share">
        <div class="floating-header-share-label">Share this <svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24">
    <path d="M7.5 15.5V4a1.5 1.5 0 1 1 3 0v4.5h2a1 1 0 0 1 1 1h2a1 1 0 0 1 1 1H18a1.5 1.5 0 0 1 1.5 1.5v3.099c0 .929-.13 1.854-.385 2.748L17.5 23.5h-9c-1.5-2-5.417-8.673-5.417-8.673a1.2 1.2 0 0 1 1.76-1.605L7.5 15.5zm6-6v2m-3-3.5v3.5m6-1v2"/>
</svg>
</div>
        <a class="floating-header-share-tw" href="https://twitter.com/share?text=Dependency%20Injection%20With%20Squire%20and%20Sinon&url=http://tysoncadenhead.com/dependency-injection-with-squire-and-sinon/" onclick="window.open(this.href, 'share-twitter', 'width=550,height=235');return false;">
            <svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 32 32"><path d="M30.063 7.313c-.813 1.125-1.75 2.125-2.875 2.938v.75c0 1.563-.188 3.125-.688 4.625a15.088 15.088 0 0 1-2.063 4.438c-.875 1.438-2 2.688-3.25 3.813a15.015 15.015 0 0 1-4.625 2.563c-1.813.688-3.75 1-5.75 1-3.25 0-6.188-.875-8.875-2.625.438.063.875.125 1.375.125 2.688 0 5.063-.875 7.188-2.5-1.25 0-2.375-.375-3.375-1.125s-1.688-1.688-2.063-2.875c.438.063.813.125 1.125.125.5 0 1-.063 1.5-.25-1.313-.25-2.438-.938-3.313-1.938a5.673 5.673 0 0 1-1.313-3.688v-.063c.813.438 1.688.688 2.625.688a5.228 5.228 0 0 1-1.875-2c-.5-.875-.688-1.813-.688-2.75 0-1.063.25-2.063.75-2.938 1.438 1.75 3.188 3.188 5.25 4.25s4.313 1.688 6.688 1.813a5.579 5.579 0 0 1 1.5-5.438c1.125-1.125 2.5-1.688 4.125-1.688s3.063.625 4.188 1.813a11.48 11.48 0 0 0 3.688-1.375c-.438 1.375-1.313 2.438-2.563 3.188 1.125-.125 2.188-.438 3.313-.875z"/></svg>
        </a>
        <a class="floating-header-share-fb" href="https://www.facebook.com/sharer/sharer.php?u=http://tysoncadenhead.com/dependency-injection-with-squire-and-sinon/" onclick="window.open(this.href, 'share-facebook','width=580,height=296');return false;">
            <svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 32 32"><path d="M19 6h5V0h-5c-3.86 0-7 3.14-7 7v3H8v6h4v16h6V16h5l1-6h-6V7c0-.542.458-1 1-1z"/></svg>
        </a>
    </div>
    <progress class="progress" value="0">
        <div class="progress-container">
            <span class="progress-bar"></span>
        </div>
    </progress>
</div>




        <footer class="site-footer outer">
            <div class="site-footer-content inner">
                <section class="copyright"><a href="../">Tyson Cadenhead</a> &copy; 2017</section>
                <nav class="site-footer-nav">
                    <a href="../">Latest Posts</a>
                    <a href="https://www.facebook.com/tysoncadenhead" target="_blank">Facebook</a>
                    <a href="https://twitter.com/tysoncadenhead" target="_blank">Twitter</a>
                    <a href="https://ghost.org" target="_blank">Ghost</a>
                </nav>
            </div>
        </footer>

    </div>

    <div id="subscribe" class="subscribe-overlay">
        <a class="subscribe-overlay-close" href="#"></a>
        <div class="subscribe-overlay-content">
                <img class="subscribe-overlay-logo" src="../content/images/2017/09/1-2.png" alt="Tyson Cadenhead">
            <h1 class="subscribe-overlay-title">Subscribe to Tyson Cadenhead</h1>
            <p class="subscribe-overlay-description">Stay up to date! Get all the latest &amp; greatest posts delivered straight to your inbox</p>
            <form method="post" action="/subscribe/" class="">
    <input class="confirm" type="hidden" name="confirm"><input class="location" type="hidden" name="location"><input class="referrer" type="hidden" name="referrer">

    <div class="form-group">
        <input class="subscribe-email" type="email" name="email" placeholder="youremail@example.com">
    </div>
    <button class="" type="submit"><span>Subscribe</span></button>
    <script type="text/javascript">(function(g,h,o,s,t){h[o]('.location')[s]=h[o]('.location')[s] || g.location.href;h[o]('.referrer')[s]=h[o]('.referrer')[s] || h.referrer;})(window,document,'querySelector','value');</script>
</form>


        </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.2.1.min.js" crossorigin="anonymous">
    </script>
    <script type="text/javascript" src="../assets/js/jquery.fitvids.js"></script>


    

    <script type="text/javascript">

    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-19696495-1']);
    _gaq.push(['_trackPageview']);

    (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://' : 'http://') + 'stats.g.doubleclick.net/dc.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();

</script>

<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css">
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>

</body>
</html>
